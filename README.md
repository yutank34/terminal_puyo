# とことんぷよぷよ

ターミナルで遊べる「とことんぷよぷよ」のGo実装です。ゲームオーバーになるまでひたすらぷよを消し続ける一人用の耐久モードです。

## 機能

- ✅ 基本的なぷよぷよゲームロジック（落下、移動、回転、消去、連鎖）
- ✅ **4色/5色モード選択**（起動時に選択可能）
- ✅ **壁キック・床キック機能**（端での回転時に自動調整）
- ✅ **設置猶予（32フレーム）** - ぷよぷよツー準拠
- ✅ **連鎖アニメーション**（連鎖が順番に表示される）
- ✅ **一時停止機能**
- ✅ ターミナルベースのカラフルなUI
- ✅ ネクストぷよ表示
- ✅ スコアとレベル管理（レベルアップで速度上昇）
- ✅ ハイスコア保存機能（`~/.puyo/highscore.json`に保存）
- ✅ ゲームオーバー判定とリスタート機能

## ゲームルール

1. 上から2つ1組のぷよが落ちてきます
2. 同じ色のぷよを4つ以上つなげると消えます
3. ぷよが消えた後、さらにつながると「連鎖」が発生し、高得点が狙えます
4. 10回消去するごとにレベルアップし、ぷよの落下速度が速くなります
5. フィールドの上までぷよが積み上がるとゲームオーバーです

## インストール

### 必要な環境

- Go 1.16以上
- ターミナル（カラー表示対応）

### ビルド方法

```bash
# リポジトリをクローン
git clone https://github.com/yutank34/terminal_puyo.git
cd terminal_puyo

# 依存関係の取得
go mod download

# ビルド
go build -o puyo

# 実行
./puyo
```

または直接実行：

```bash
go run .
```

### 初回起動

起動すると、まず色数選択メニューが表示されます：
- **4色モード**: 初心者向け（赤、緑、青、黄）
- **5色モード**: 上級者向け（赤、緑、青、黄、紫）

↑↓キーで選択し、Enterで決定してください。

## 操作方法

### メニュー画面
| キー | 動作 |
|------|------|
| ↑ ↓ | 選択項目を移動 |
| Enter | 決定 |
| Q / Esc | 終了 |

### ゲーム中
| キー | 動作 |
|------|------|
| ← → | ぷよを左右に移動 |
| ↓ | ソフトドロップ（素早く落下） |
| Z | 反時計回りに回転 |
| X | 時計回りに回転 |
| P | 一時停止 / 再開 |
| Q / Esc | ゲーム終了 |
| R | リスタート（ゲームオーバー時） |

### 操作のコツ
- **設置猶予**: ぷよが地面に着いても約0.5秒（32フレーム）は移動・回転可能です
- **壁キック**: 壁際で回転すると自動的に内側にずれて回転します
- **床キック**: 地面付近で回転すると自動的に上にずれて回転します
- **ソフトドロップ**: ↓キーを押し続けると素早く落下します

## スコアリング

- 基本点：100点 × 連鎖倍率 × 消去回数
- 連鎖倍率：1連鎖 = x1, 2連鎖 = x2, 3連鎖 = x4, 4連鎖 = x8...（2倍ずつ増加）
- レベルアップ：10回消去ごとにレベルが1上がります
- 速度上昇：レベル20まで徐々に速くなります

## プロジェクト構成

```
.
├── .gitignore        # Git除外ファイル設定
├── game.go           # ゲームロジック（フィールド、ぷよ、移動、消去、連鎖）
├── game_test.go      # ゲームロジックのユニットテスト（31テスト）
├── ui.go             # ゲーム画面UI（tcell使用）
├── menu.go           # メニュー画面UI（色数選択）
├── highscore.go      # ハイスコア保存・読み込み
├── highscore_test.go # ハイスコア機能のテスト
├── main.go           # メインエントリーポイント
├── go.mod            # Go モジュール設定
├── go.sum            # Go 依存関係チェックサム
└── README.md         # このファイル
```

## テスト

ユニットテストを実行：

```bash
go test -v
```

全てのテストが成功することを確認：

```bash
go test -cover
```

## 実装の詳細

### ゲームフィールド

- フィールドサイズ: 6列 × 12行
- 4色または5色のぷよがランダムに出現
  - 4色モード: 赤、緑、青、黄
  - 5色モード: 赤、緑、青、黄、紫
- 同じ色が4つ以上つながると消去

### 連鎖の仕組み

1. ぷよペアが着地して固定
2. 重力を適用（落下）
3. 4つ以上つながったぷよを検出・消去
4. 画面に「N CHAIN!」と表示
5. 再び重力を適用
6. さらにつながりができたら3に戻る（連鎖継続）
7. つながりがなくなったら次のぷよペアを出現

### ぷよぷよツー準拠の仕様

- **設置猶予（Lock Delay）**: 32フレーム（約0.53秒）
  - 地面に着いてから32フレームは移動・回転が可能
  - 横移動または回転でカウンターがリセット
- **壁キック（Wall Kick）**: 壁際での回転時に自動調整
  - 左右1マス、上1マスの順に試行
- **床キック（Floor Kick）**: 地面付近での回転時に自動調整
- **60FPSでのフレームカウント**: 正確なタイミング制御

### データ保存

ハイスコアは以下の場所に自動保存されます：
- macOS/Linux: `~/.puyo/highscore.json`
- Windows: `%USERPROFILE%\.puyo\highscore.json`

## 技術スタック

- **言語**: Go 1.16+
- **UIライブラリ**: [tcell](https://github.com/gdamore/tcell) - クロスプラットフォームのターミナルUI
- **テスト**: Go標準のtestingパッケージ（カバレッジ100%を目指して実装）

## 今後の拡張案

- [ ] おじゃまぷよの実装
- [ ] 全消しボーナス
- [ ] 3色/6色モードの追加
- [ ] 難易度設定（落下速度のカスタマイズ）
- [ ] 効果音・BGM
- [ ] リプレイ機能
- [ ] オンラインランキング
- [ ] AI対戦モード

## スクリーンショット

```
とことんぷよぷよ

Score: 1500
Level: 3
Chains: 5
Colors: 4

┌────────────┐
│ ●  ●    ● │
│ ●● ● ● ●●│
│●●●●●●●●│
│●●●●●●●●│
└────────────┘

Next:
●
●

Controls:
←→: Move
↓: Drop
Z/X: Rotate
P: Pause
Q: Quit
```

## ライセンス

MIT License

## 作者

Claude Code で実装されました

## 参考

ぷよぷよは株式会社セガの登録商標です。このプロジェクトは教育目的の個人プロジェクトであり、公式のものではありません。

---

**楽しんでください！** 連鎖を繋げて高得点を目指しましょう！ 🎮✨
