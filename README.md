# とことんぷよぷよ

ターミナルで遊べる「とことんぷよぷよ」のGo実装です。ゲームオーバーになるまでひたすらぷよを消し続ける一人用の耐久モードです。

## 機能

- ✅ 基本的なぷよぷよゲームロジック（落下、移動、回転、消去、連鎖）
- ✅ ターミナルベースのカラフルなUI
- ✅ ネクストぷよ表示
- ✅ スコアとレベル管理（レベルアップで速度上昇）
- ✅ ハイスコア保存機能（`~/.puyo/highscore.json`に保存）
- ✅ ゲームオーバー判定とリスタート機能

## ゲームルール

1. 上から2つ1組のぷよが落ちてきます
2. 同じ色のぷよを4つ以上つなげると消えます
3. ぷよが消えた後、さらにつながると「連鎖」が発生し、高得点が狙えます
4. 10回消去するごとにレベルアップし、ぷよの落下速度が速くなります
5. フィールドの上までぷよが積み上がるとゲームオーバーです

## インストール

### 必要な環境

- Go 1.16以上
- ターミナル（カラー表示対応）

### ビルド方法

```bash
# 依存関係の取得
go get github.com/gdamore/tcell/v2

# ビルド
go build -o puyo

# 実行
./puyo
```

または直接実行：

```bash
go run .
```

## 操作方法

| キー | 動作 |
|------|------|
| ← → | ぷよを左右に移動 |
| ↓ | ソフトドロップ（1マス下に移動） |
| Space | ハードドロップ（一気に落とす） |
| Z | 反時計回りに回転 |
| X | 時計回りに回転 |
| Q / Esc | ゲーム終了 |
| R | リスタート（ゲームオーバー時） |

## スコアリング

- 基本点：100点 × 連鎖倍率 × 消去回数
- 連鎖倍率：1連鎖 = x1, 2連鎖 = x2, 3連鎖 = x4, 4連鎖 = x8...（2倍ずつ増加）
- レベルアップ：10回消去ごとにレベルが1上がります
- 速度上昇：レベル20まで徐々に速くなります

## プロジェクト構成

```
.
├── game.go           # ゲームロジック（フィールド、ぷよ、移動、消去、連鎖）
├── game_test.go      # ゲームロジックのユニットテスト
├── ui.go             # ターミナルUI（tcell使用）
├── highscore.go      # ハイスコア保存・読み込み
├── highscore_test.go # ハイスコア機能のテスト
├── main.go           # メインエントリーポイント
├── go.mod            # Go モジュール設定
└── README.md         # このファイル
```

## テスト

ユニットテストを実行：

```bash
go test -v
```

全てのテストが成功することを確認：

```bash
go test -cover
```

## 実装の詳細

### ゲームフィールド

- フィールドサイズ: 6列 × 12行
- 5色のぷよ（赤、緑、青、黄、紫）がランダムに出現
- 同じ色が4つ以上つながると消去

### 連鎖の仕組み

1. ぷよペアが着地
2. 重力を適用（落下）
3. 4つ以上つながったぷよを検出・消去
4. 再び重力を適用
5. さらにつながりができたら3に戻る（連鎖）
6. つながりがなくなったら次のぷよペアを出現

### データ保存

ハイスコアは以下の場所に自動保存されます：
- macOS/Linux: `~/.puyo/highscore.json`
- Windows: `%USERPROFILE%\.puyo\highscore.json`

## 今後の拡張案

- [ ] おじゃまぷよの実装
- [ ] 全消しボーナス
- [ ] 効果音・BGM
- [ ] リプレイ機能
- [ ] オンラインランキング
- [ ] AI対戦モード

## ライセンス

MIT License

## 作者

Claude Code で実装されました

## 参考

ぷよぷよは株式会社セガの登録商標です。このプロジェクトは教育目的の個人プロジェクトであり、公式のものではありません。
